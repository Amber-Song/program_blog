<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="../program_blog.css" />
  </head>

  <body>
    <div class="web-page">
      <!-- This is title -->
      <p class="title">
        amber$ cd <a href="../index.html" class="codestyle">main</a>/<a
          href="../Program_golang.html"
          class="codestyle"
          >Golang</a
        >/<a href="./program_golang_nil_pointer.html" class="codestyle"
          >\[Golang\]\ nil\ pointer\ cause\ panic</a
        >
      </p>
      <h1>[Golang] nil pointer cause panic</h1>

      <div class="info">
        When creating a pointer point to the struct, it is very easy to forget
        to assign the memory to that pointer. I made a mistake before. In line
        19, I just write <br /><strong>var pointer1 *pointer</strong> <br />
        instead of var pointer1 *pointer = new(pointer). So I got a panic <br />
        <strong>
          panic: runtime error: invalid memory address or nil pointer
          dereference</strong
        >
        <br />
        That is because when creating a pointer variable, it didn't assign the
        memory to that variable the pointer point to. So when the pointer tries
        to access the memory and get the value or tries to change the value, it
        will get panic. <br /><br />
        Here is the demo:
      </div>

      <!-- This is the container title for the code and result -->
      <div class="title-for-container">Code:</div>
      <div class="title-for-container">Result:</div>
      <!-- This is code on the left -->
      <div class="code-container">
        <div class="pre-code" id="pre-code"></div>
        <textarea cols="30" rows="30" disabled>
package main

import (
  "fmt"
)

type pointer struct {
  x int
  y int
}

func main() {
  var pointer0 pointer
  fmt.Println("pointer0 ---- x = ", pointer0.x, ", y = ", pointer0.y)
  pointer0.x = 50
  pointer0.y = 100
  fmt.Println("pointer0 ---- x = ", pointer0.x, ", y = ", pointer0.y)

  var pointer1 *pointer = new(pointer)
  fmt.Println("pointer1 ---- x = ", pointer1.x, ", y = ", pointer1.y)
  pointer1.x = 500
  pointer1.y = 1000
  fmt.Println("pointer1 ---- x = ", pointer1.x, ", y = ", pointer1.y)
  
  var pointer2 *pointer
  pointer2 = &pointer{x:5, y:10}
  fmt.Println("pointer2 ---- x = ", pointer2.x, ", y = ", pointer2.y)	
}
        </textarea>
      </div>

      <!-- This is result on the right -->
      <div class="result-container">
        <a href="https://play.golang.org/p/MdBes5soN6I">Run on Go Playground</a>
        <br />
        <br />
        I got the result as follow: <br />
        pointer0 ---- x = 0 , y = 0 <br />pointer0 ---- x = 50 , y = 100
        <br />pointer1 ---- x = 0 , y = 0 <br />pointer1 ---- x = 500 , y = 1000
        <br />pointer2 ---- x = 5 , y = 10
      </div>

      <div class="info">
        So as the array. If the array was declared but wasn't initiated, when it
        is accessed, the program will panic. I got a panic for this reason.
        <br />
        <strong
          >panic: runtime error: index out of range [0] with length 0</strong
        >
        <br />
        Here is the code.
      </div>

      <!-- This is the container title for the code and result -->
      <div class="title-for-container">Code:</div>
      <div class="title-for-container">Result:</div>
      <!-- This is code on the left -->
      <div class="code-container">
        <div class="pre-code" id="pre-code1"></div>
        <textarea cols="30" rows="15" disabled>
func main() {
  array1 := make([][]int,3)
  array1[0] = []int{0,1,2} 
  fmt.Println("array1 = ", array1)
  
  array2 := [][]int{}	
  array2[0] = []int{0,1,2} 
  fmt.Println("array2 = ", array2)
  
  var array3 [][]int
  array3[0] = []int{0,1,2} 
  fmt.Println("array = ", array3)	
}  
        </textarea>
      </div>

      <!-- This is result on the right -->
      <div class="result-container">
        <a href="https://play.golang.org/p/Jm9NJ5UvQ2e">Run on Go Playground</a>
        <br />
        <br />
        array1 = [[0 1 2] [] []] <br />
        panic: runtime error: index out of range [0] with length 0 <br /><br />

        goroutine 1 [running]: <br />
        main.main() <br />
        /tmp/sandbox232300460/prog.go:19 +0x157 <br /><br />

        Both array2 and array3 got panic.
      </div>

      <script>
        window.onload = function() {
          let text = "";
          // TODO: change the i < max to how many lines in the code
          for (let i = 1; i < 29; i++) {
            text += i + "<br/>";
          }
          document.getElementById("pre-code").innerHTML = text;
          text = "";
          for (let i = 1; i < 15; i++) {
            text += i + "<br/>";
          }
          document.getElementById("pre-code1").innerHTML = text;
        };
      </script>
    </div>
  </body>
</html>
